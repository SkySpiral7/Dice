<!DOCTYPE HTML>
<html>
<head>
<title>Pathfinder Attack Helper</title>
<meta charset="ASCII" />
<script id="DiceInclude" type="text/javaScript" src="../javascript/include.js"></script>
<script>
var characters = [];
function safeButton(functionName)
{
   try
   {
      functionName();
   }
   catch (exception)
   {
      alert('An error has occurred check the console for details.\n' + exception);
      throw exception;
   }
}
function createCharacterOptions()
{
   characters = eval(document.getElementById('characterData').value);
   var characterOptions = '';
   for (var i=0; i < characters.length; ++i)
   {
      characterOptions += '<option value="' + i + '">' + characters[i].name + '</option>';
   }
   document.getElementById('attacker').innerHTML = characterOptions;
   createAttackOptions();
   document.getElementById('target').innerHTML = characterOptions;
}
function createAttackOptions()
{
   var characterAttacks = characters[document.getElementById('attacker').value].attacks;
   var attackOptions = '';
   for (var i=0; i < characterAttacks.length; ++i)
   {
      attackOptions += '<option value="' + i + '">' + characterAttacks[i].name + '</option>';
   }
   document.getElementById('attackUsed').innerHTML = attackOptions;
}
function attack()
{
   var input = createAttackInput();
   document.getElementById('result').value = Prebuilt.PathfinderAttack(input).toString();
}
function createAttackInput()
{
   var attacker = characters[document.getElementById('attacker').value];
   var attackUsed = attacker.attacks[document.getElementById('attackUsed').value];
   var isTouchAttack = (true === attackUsed.isTouchAttack);

   var target = characters[document.getElementById('target').value];
   var isFlatFooted = document.getElementById('flatFooted').checked;

   var targetAc = undefined;
   if(isFlatFooted && isTouchAttack) targetAc = target.armorClass.flatTouch;
   else if(isFlatFooted) targetAc = target.armorClass.flat;
   else if(isTouchAttack) targetAc = target.armorClass.touch;
   else targetAc = target.armorClass.normal;

   return {opposingAc: targetAc, attackBonus: attackUsed.attackBonus, weapon: attackUsed, damageReduction: target.damageReduction};
}
//TODO: initiative
</script>
</head>
<body>
<!----
<script type="text/javaScript" src="../../../../Miscellaneous/src/main/javascript/testRunner.js"></script>
<script type="text/javaScript" src="../../test/html/Pathfinder.js"></script>
<textarea id="testResults" cols="80" rows="20"></textarea><br />
<input type="button" onclick="TestRunner.testAll();" value="Test file" />
<br />
<!---->
<label for="characterData">Character Data:</label><br />
<textarea cols="120" rows="20" id="characterData">[
   {name: "Character name",
      armorClass: {normal: 12, flat: 11, touch: 10, flatTouch: 9}, damageReduction: 0,
      attacks: [
         {name: "Attack name", attackBonus: 1, minimumCritical: 20, criticalMultiplier: 2, damageString: "1d8", flatDamageModifer: 3, extraDamageDiceString: "1d6", isTouchAttack: false}
      ]
   }
]</textarea>
<br />
<input type="button" onclick="safeButton(createCharacterOptions);" value="Parse Character Data" id="parseCharacterButton" /><br />
<br />
<label>Attacker: <select id="attacker" onchange="createAttackOptions();"></select></label> <label>using: <select id="attackUsed"></select></label><br />
<label>Target: <select id="target"></select></label> <label>Flat-footed? <input type="checkbox" id="flatFooted" /></label><br />
<br />
<input type="button" onclick="safeButton(attack);" value="Attack" id="attackButton" /><br />
<br />
<label>Result: <input type="text" readonly="true" id="result" size="30" /></label><br />
<script>document.getElementById('characterData').focus();</script>
</body>
</html>
