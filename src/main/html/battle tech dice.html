<!DOCTYPE HTML>
<html>
<head>
<title>BattleTech Dice</title>
<meta charset="ASCII" />
<script id="DiceInclude" type="text/javaScript" src="../javascript/include.js"></script>
<script type="text/javaScript">
'use strict';
function attack()
{
   clearOut();
   var toHit = document.getElementById('toHit').value.trim();
   if(!(/^\d+$/).test(toHit) || '0' === toHit){document.getElementById('result').innerHTML = 'Invalid to hit value'; return;}
   toHit = Number.parseInt(toHit);
   if(toHit > 12){document.getElementById('result').innerHTML = 'Impossible to hit'; return;}
   if(Dice.of2d6.sumRoll() < toHit){document.getElementById('result').innerHTML = 'Miss'; return;}
   document.getElementById('result').innerHTML = 'Hit';
   document.getElementById('location').innerHTML = Dice.of2d6.sumRoll();
   var critCount = 0;
   var criticalDice = Dice.of2d6.sumRoll();
   if(12 === criticalDice) critCount = 3;  //"Head/Limb Blown Off" the 3 is only for torso. "Total Warfare" rules?
   else if(criticalDice >= 10) critCount = 2;
   else if(criticalDice >= 8) critCount = 1;
   document.getElementById('critCount').value = critCount;
   critBoth();
}
var currentCritical = [];
function critBoth()
{
   var critCount = document.getElementById('critCount').value;
   currentCritical = [];
   while (critCount > 0)
   {
      var nextCritical = {};
      nextCritical.isUpper = (2 === Dice.coin.roll()[0]);
      nextCritical.area = Dice.d6.roll()[0];
      currentCritical.push(nextCritical);
      --critCount;
   }
   generateCriticalString();
}
function generateCriticalString()
{
   var criticalString = '';
   document.getElementById('criticalLocation').innerHTML = '';
   for (var i = 0; i < currentCritical.length; ++i)
   {
      if(currentCritical[i].isUpper) criticalString += 'Upper';
      else criticalString += 'Lower';
      criticalString += ' ' + currentCritical[i].area;
      if ((i + 1) !== currentCritical.length)
      {
          criticalString += ', ';
      }
   }
   document.getElementById('criticalLocation').innerHTML = criticalString;
}
function critArea()
{
   for (var i = 0; i < currentCritical.length; ++i)
   {
      currentCritical[i].area = Dice.d6.roll()[0];
   }
   generateCriticalString();
}
function clearOut()
{
   document.getElementById('result').innerHTML = '';
   document.getElementById('location').innerHTML = '';
   document.getElementById('critCount').value = '';
   document.getElementById('criticalLocation').innerHTML = '';
}

var Dice = {
   combatParalysisDicePool: new DicePool('3d6 drop highest'),
   of2d6: new DicePool('2d6'),
   d6: new Die(6),
   coin: new Die(2)
};
function rollInitiative()
{
   var initiative;
   if(document.getElementById('combatParalysis').checked) initiative = Dice.combatParalysisDicePool.sumRoll();
   else initiative = Dice.of2d6.sumRoll();
   document.getElementById('initiative').innerHTML = initiative;
}
</script>
</head>
<body>
<br />
<!----
<script type="text/javaScript" src="../../../../Miscellaneous/src/main/javascript/testRunner.js"></script>
<script type="text/javaScript" src="../../test/html/Pathfinder.js"></script>
<textarea id="testResults" cols="80" rows="20"></textarea><br />
<input type="button" onclick="TestRunner.testAll();" value="Test file" />
<br />
<!---->
<input type="button" onclick='rollInitiative();' value="Roll Initiative" />
<label>with Combat Paralysis: <input type="checkbox" id="combatParalysis" /></label>
Result: <span id="initiative"></span><br />
<br />
<table>
    <tr><td style="float: right;">How high to hit? </td><td><input type="text" size="2" id="toHit" value="7" /></td></tr>
    <tr><td>&nbsp;</td><td><input type="button" onclick="attack();" value="Attack" /></td></tr>
    <tr><td style="float: right;">Result: </td><td><span id="result"></span></td></tr>
    <tr><td style="float: right;">Location: </td><td><span id="location"></span></td></tr>
    <tr><td style="float: right;">Critical Count: </td><td><input type="text" size="2" id="critCount" /></td></tr>
    <tr><td style="float: right;">Critical Location: </td><td style="width: 200px;"><span id="criticalLocation"></span></td></tr>
</table>
<br />The 2 buttons below will use the number in Critical Count.<br />
<input type="button" onclick="critBoth();" value="Reroll All Critical locations" />
<input type="button" onclick="critArea();" value="Reroll Critical Area #s" />
<br /><br />Note that I don't know much about this game. I think it may be using the "Total Warfare" rules.
<br />3 critical hits means "Head/Limb Blown Off" or 3 torso locations.
<br />It's been a long time since I played (didn't know the rules at the time) and the rules are confusing so I may delete this file since it doesn't help reduce the complexity much.
<script>document.getElementById('toHit').focus();</script>
</body>
</html>
