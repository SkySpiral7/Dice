<!DOCTYPE HTML>
<html>
<head>
<title>Warhammer Dice Helper</title>
<meta charset="ASCII" />
<script id="DiceInclude" src="library/include.js"></script>
<script type="text/javaScript">
function processWoundMax(stats)
{
   var maxWounds = Number.parseInt(document.getElementById('woundMax').value);
   if(maxWounds < 1) throw new Error('The maximum number of wounds must be at least 1');
   while (stats[stats.length-1].result > maxWounds && stats.length > 1)  //too many wounds
   {
      stats[stats.length-2].probability += stats[stats.length-1].probability;
      stats.pop();  //then remove the last
   }
}
Draw.generateBinomialTable = function(stats, secondColumn)
{
   if('=' === secondColumn) secondColumn = '==';
   processWoundMax(stats);
   var aggregates = Statistics.calculateAggregates(stats);

   minResult.textContent = aggregates.minimum;
   maxResult.textContent = aggregates.maximum;
   avgResult.textContent = aggregates.mean.toFixed(2);
   devResult.textContent = aggregates.standardDeviation.toFixed(3);

   var output = GenerateHtml.statistics(stats, secondColumn);
   document.getElementById('graphResults').innerHTML = output.replace('<th>Roll</th>', '<th>Wounds Inflicted</th>');
};
function parseInput()
{
   var input = {};
   input.diceCount = Number.parseInt(document.getElementById('diceCount').value);
   document.getElementById('diceCount').value = input.diceCount;
   input.maxWounds = Number.parseInt(document.getElementById('woundMax').value);
   document.getElementById('woundMax').value = input.maxWounds;
   input.toHitValue = Number.parseInt(document.getElementById('toHitValue').value);
   document.getElementById('toHitValue').value = input.toHitValue;
   input.toWoundValue = Number.parseInt(document.getElementById('toWoundValue').value);
   document.getElementById('toWoundValue').value = input.toWoundValue;
   input.saveValue = Number.parseInt(document.getElementById('saveValue').value);
   document.getElementById('saveValue').value = input.saveValue;
   input.reanimateOrNoPainValue = Number.parseInt(document.getElementById('reanimateOrNoPainValue').value);
   document.getElementById('reanimateOrNoPainValue').value = input.reanimateOrNoPainValue;
   input.customColumn = document.getElementById('customColumn').value;
   return input;
}
function rollAttack()
{
   hitResult.textContent = '-';
   woundedResult.textContent = '-';
   unsaveWoundsResult.textContent = '-';

   var input = parseInput();

   try{
      var output = Prebuilt.WarhammerAttackUnit(input);
      hitResult.textContent = output.hit;  //always exists
      if(undefined !== output.wounded) woundedResult.textContent = output.wounded;
      if(undefined !== output.unsavedWounds) unsaveWoundsResult.textContent = output.unsavedWounds;
   }
   catch(error){alert('Error: ' + error.message); throw error;}
};
function mainDraw()
{
   document.getElementById('graphResults').innerHTML = '';
   minResult.textContent = '-';
   maxResult.textContent = '-';
   avgResult.textContent = '-';
   devResult.textContent = '-';

   var input = parseInput();

   try{
      var stats = Prebuilt.WarhammerAttackUnit.Statistics(input);
      Draw.generateBinomialTable(stats, input.customColumn);
   }
   catch(error){alert('Error: ' + error.message); throw error;}
};
</script>
<a>The random values are in order: number of enemies hit, number wounded, number of unsaved wounds.</a>
<form action="javascript:mainDraw();">
<table>
   <tr>
      <td style="text-align:right;">Number of Dice: </td>
      <td><input type="text" value="15" size="5" id="diceCount" /></td>
      <td>Random Values</td>
      <td>Statistics</td>
   </tr>
   <tr>
      <td style="text-align:right;">Number of Wounds Possible: </td>
      <td><input type="text" value="15" size="5" id="woundMax" /></td>
      <td />
   </tr>
   <tr>
      <td style="text-align:right;">To Hit Value: </td>
      <td><input type="text" value="3" size="5" id="toHitValue" /></td>
      <td id="hitResult" style="text-align:center;">-</td>
      <td><b>Min:</b> <span id="minResult" style="text-align:center;">-</span></td>
   </tr>
   <tr>
      <td style="text-align:right;">To Wound Value: </td>
      <td><input type="text" value="3" size="5" id="toWoundValue" /></td>
      <td id="woundedResult" style="text-align:center;">-</td>
      <td><b>Max:</b> <span id="maxResult" style="text-align:center;">-</span></td>
   </tr>
   <tr>
      <td style="text-align:right;">To Save Value: </td>
      <td><input type="text" value="4" size="5" id="saveValue" /></td>
      <td />
      <td><b>Avg:</b> <span id="avgResult" style="text-align:center;">-</span></td>
   </tr>
   <tr>
      <td style="text-align:right;">Reanimation or Feel No Pain: </td>
      <td><input type="text" value="7" size="5" id="reanimateOrNoPainValue" /></td>
      <td id="unsaveWoundsResult" style="text-align:center;">-</td>
      <td><b>Std Dev:</b> <span id="devResult" style="text-align:center;">-</span></td>
   </tr>
   <tr>
      <td style="text-align:right;">Custom Column: </td>
      <td><input type="text" value=">=" size="5" id="customColumn" /></td>
      <td /><td />
   </tr>
   <tr>
     <td />
     <td><input type="submit" value="Draw" /></td><!--This is a submit button so that you can press enter in any field-->
     <td><input type="button" value="Attack" onClick="javascript:rollAttack();" /></td>
     <td />
   </tr>
</table>
</form>
<br />
<div id="graphResults"></div>
<br /><br /><br /><br />
</html>
